{"ast":null,"code":"import _defineProperty from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Header from\"./Header\";import Footer from\"./Footer\";import Button from'react-bootstrap/Button';import Form from'react-bootstrap/Form';import FormGroup from'react-bootstrap/FormGroup';import InputGroup from'react-bootstrap/InputGroup';import qs from'qs';function ApplicationForm(){var _useState=useState([{}]),_useState2=_slicedToArray(_useState,2),courseList=_useState2[0],setCourseList=_useState2[1];var _useState3=useState({username:\"\",email:\"\",staffid:\"\",post:\"\",dept:\"\",course:\"\"}),_useState4=_slicedToArray(_useState3,2),newValue=_useState4[0],setNewValue=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isDataObtained=_useState6[0],setIsDataObtained=_useState6[1];var fields=[\"姓名\",\"電郵\",\"職員編號\",\"職位\",\"單位\",\"報讀課程\"];var role=\"\";function getFutureCourses(){var futureCourseURL=\"/futureCourse\";var futureCourseOptions={method:\"GET\",headers:{\"Accept\":\"application/json\"}};fetch(futureCourseURL,futureCourseOptions).then(function(res){return res.json();}).then(function(res){console.log(\"Rendering future course\");if(res.length>0){setCourseList(res);setNewValue(function(prevValue){var date=new Date(res[0].date);var dateStr=date.toLocaleDateString();return _objectSpread(_objectSpread({},prevValue),{},{course:res[0].courseName+\" \"+dateStr});});}setIsDataObtained(true);}).catch(function(err){console.log(\"futureCourse: \"+err);});}useEffect(function(){console.log(\"rendering user\");if(!isDataObtained){var url=\"/user\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"username\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){return res.json();}).then(function(res){role=res.role;if(role===\"admin\"){localStorage.setItem(\"isAdmin\",true);}setNewValue({username:res.name,email:res.username,staffid:res.staffid,post:res.post,dept:res.dept,course:\"\"});}).catch(function(err){console.log(\"user: \"+err);});getFutureCourses();}});function enroll(course){console.log(\"rendering course\");var url=\"/enroll\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseID\":course._id,\"enrollment\":newValue,\"registeredBy\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){if(res.status===200){alert(\"成功報讀課程\");clearInput();// setNewValue(prevValue => {\n//     return {\n//         ...prevValue,\n//         username: \"\",\n//         email: \"\",\n//         staffid: \"\",\n//         post: \"\",\n//         dept: \"\"\n//     }\n// });\n}else{alert(\"未能成功報讀課程, 請稍後再嘗試\");}}).catch(function(err){console.log(\"enroll: \"+err);});}function waitinglist(courseName,courseDate){console.log(\"rendering waitinglist\");var url=\"/waitinglist\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseName\":courseName,\"courseDate\":courseDate,\"enrollment\":newValue,\"registeredBy\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){if(res.status===200){alert(\"課程名額暫滿，你將會加進後備名單。如最後能夠成功報讀，屆時將會以公司電郵通知\");clearInput();// setNewValue(prevValue => {\n//     return {\n//         ...prevValue,\n//         username: \"\",\n//         email: \"\",\n//         staffid: \"\",\n//         post: \"\",\n//         dept: \"\"\n//     }\n// });\n}else{alert(\"發生錯誤，請稍後再嘗試\");}}).catch(function(err){console.log(\"waitinglist: \"+err);});}function checkQuota(){var courseInfo=newValue.course.split(' ');var courseName=newValue.course.split(' ')[0];var courseDate=newValue.course.split(' ')[1];console.log(\"Rendering Check quota\");var url=\"/checkQuota\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseName\":courseName,\"courseDate\":courseDate})};fetch(url,options).then(function(res){if(res.status===200){return res.json();}else{alert(\"發生錯誤，請稍後再嘗試\");return\"error\";}}).then(function(res){console.log(res);if(res.quota===0){waitinglist(courseName,courseDate);}else if(res!==\"error\"){enroll(res);}}).catch(function(err){console.log(\"Login: \"+err);});}function handleSubmit(event){event.preventDefault();checkQuota();//enroll();\n}function clearInput(){setNewValue(function(prevValue){return _objectSpread(_objectSpread({},prevValue),{},{username:\"\",email:\"\",staffid:\"\",post:\"\",dept:\"\",course:\"\"});});}function handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;setNewValue(function(prevValue){return _objectSpread(_objectSpread({},prevValue),{},_defineProperty({},name,value));});console.log(newValue);}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(\"img\",{src:\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\",className:\"formIcon\"}),/*#__PURE__*/React.createElement(Form,{className:\"inputForm\",onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,console.log(\"Rendering name input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u540D\\u7A31:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[0],size:\"lg\",onChange:handleChange,value:newValue.username,name:\"username\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"inputItem\"},console.log(\"Rendering email input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u96FB\\u90F5:\"),/*#__PURE__*/React.createElement(InputGroup,null,/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[1],size:\"lg\",name:\"email\",type:\"text\",onChange:handleChange,value:newValue.email,className:\"input\"}),/*#__PURE__*/React.createElement(InputGroup.Append,null,/*#__PURE__*/React.createElement(InputGroup.Text,null,\"@hohsc.org.hk\")))))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,console.log(\"Rendering staffid input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u8077\\u54E1\\u7DE8\\u865F:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[2],size:\"lg\",onChange:handleChange,value:newValue.staffid,name:\"staffid\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,console.log(\"Rendering post input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u8077\\u4F4D:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[3],size:\"lg\",onChange:handleChange,value:newValue.post,name:\"post\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,console.log(\"Rendering dept input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u55AE\\u4F4D:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[4],size:\"lg\",onChange:handleChange,value:newValue.dept,name:\"dept\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,console.log(\"Rendering course input\"),/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u5831\\u8B80\\u8AB2\\u7A0B:\"),/*#__PURE__*/React.createElement(Form.Control,{size:\"lg\",onChange:handleChange,value:newValue.course,name:\"course\",as:\"select\"},/*#__PURE__*/React.createElement(\"option\",null,\"\\u8ACB\\u9078\\u64C7\\u8AB2\\u7A0B\"),courseList.length>0&&courseList.map(function(course){var date=new Date(course.date);return/*#__PURE__*/React.createElement(\"option\",null,course.courseName,\" \",date.toLocaleDateString());}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"btnWrapper\"},/*#__PURE__*/React.createElement(Button,{variant:\"primary\",size:\"lg\",type:\"submit\",className:\"submitBtn\"},\"\\u63D0\\u4EA4\",console.log(\"Rendering submitbtn\")),/*#__PURE__*/React.createElement(Button,{variant:\"danger\",size:\"lg\",onClick:clearInput,className:\"clearBtn\"},\"\\u6E05\\u9664\\u6240\\u6709\\u8CC7\\u6599\",console.log(\"Rendering clearbtn\")))),/*#__PURE__*/React.createElement(Footer,{role:role}));}export default ApplicationForm;","map":{"version":3,"sources":["/Users/cheukheilo/Desktop/hohcsSignup/client/src/components/ApplicationForm.jsx"],"names":["React","useState","useEffect","Header","Footer","Button","Form","FormGroup","InputGroup","qs","ApplicationForm","courseList","setCourseList","username","email","staffid","post","dept","course","newValue","setNewValue","isDataObtained","setIsDataObtained","fields","role","getFutureCourses","futureCourseURL","futureCourseOptions","method","headers","fetch","then","res","json","console","log","length","prevValue","date","Date","dateStr","toLocaleDateString","courseName","catch","err","url","options","body","stringify","localStorage","getItem","setItem","name","enroll","_id","status","alert","clearInput","waitinglist","courseDate","checkQuota","courseInfo","split","quota","handleSubmit","event","preventDefault","handleChange","target","value","map"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport FormGroup from 'react-bootstrap/FormGroup';\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport qs from 'qs';\n\nfunction ApplicationForm(){\n\n\n    const [courseList, setCourseList] = useState([{}]);\n\n    const [newValue, setNewValue] = useState({\n        username: \"\",\n        email: \"\",\n        staffid: \"\",\n        post: \"\",\n        dept: \"\",\n        course: \"\",\n    });\n    \n    const [isDataObtained, setIsDataObtained] = useState(false);\n   \n\n    const fields = [\"姓名\", \"電郵\", \"職員編號\", \"職位\", \"單位\", \"報讀課程\"];\n    var role = \"\";\n\n    function getFutureCourses(){\n\n        const futureCourseURL = \"/futureCourse\";\n        const futureCourseOptions = {\n            method: \"GET\",\n            headers: {\n              \"Accept\": \"application/json\",\n            }\n        };\n\n        fetch(futureCourseURL, futureCourseOptions)\n        .then(res => res.json())\n        .then(res => {\n            console.log(\"Rendering future course\");\n            if(res.length > 0){\n                    setCourseList(res);\n                    setNewValue(prevValue => {\n    \n                        const date = new Date(res[0].date);\n                        const dateStr = date.toLocaleDateString();\n    \n                        return{\n                            ...prevValue,\n                            course: res[0].courseName + \" \" + dateStr\n                        }\n                    })\n                }\n            setIsDataObtained(true);\n        }).catch(err => {\n            console.log(\"futureCourse: \" + err);\n        });\n    }\n\n    useEffect( () => {\n\n        console.log(\"rendering user\");\n\n        if(!isDataObtained){\n            const url = \"/user\";\n            const options = {\n                method: \"POST\",\n                headers: {\n                  \"Accept\": \"application/json\",\n                  \"Content-Type\": \"application/x-www-form-urlencoded\"\n                },\n                body: qs.stringify({\"username\": localStorage.getItem(\"username\")})\n            };\n\n            fetch(url, options)\n            .then(res => res.json())\n            .then(res => {\n\n                role = res.role;\n\n                if(role === \"admin\"){\n                    localStorage.setItem(\"isAdmin\", true);\n                }\n\n                setNewValue({\n                    username: res.name,\n                    email: res.username,\n                    staffid: res.staffid,\n                    post: res.post,\n                    dept: res.dept,\n                    course: \"\",\n                })\n            }).catch(err => {\n                console.log(\"user: \" + err);\n            });\n            getFutureCourses();\n        }\n            \n\n    })\n\n    function enroll(course){\n\n        console.log(\"rendering course\");\n\n        const url = \"/enroll\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseID\": course._id, \n                \"enrollment\": newValue,\n                \"registeredBy\": localStorage.getItem(\"username\")\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                alert(\"成功報讀課程\");\n                clearInput();\n                // setNewValue(prevValue => {\n                    \n                //     return {\n                //         ...prevValue,\n                //         username: \"\",\n                //         email: \"\",\n                //         staffid: \"\",\n                //         post: \"\",\n                //         dept: \"\"\n                //     }\n\n                // });\n            }else{\n                alert(\"未能成功報讀課程, 請稍後再嘗試\");\n            }\n        }).catch(err => {\n            console.log(\"enroll: \" + err);\n        });\n    }\n\n\n\n    function waitinglist(courseName, courseDate){\n\n        console.log(\"rendering waitinglist\");\n\n        const url = \"/waitinglist\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseName\": courseName,\n                \"courseDate\": courseDate,\n                \"enrollment\": newValue,\n                \"registeredBy\": localStorage.getItem(\"username\")\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                alert(\"課程名額暫滿，你將會加進後備名單。如最後能夠成功報讀，屆時將會以公司電郵通知\");\n                clearInput();\n                // setNewValue(prevValue => {\n                    \n                //     return {\n                //         ...prevValue,\n                //         username: \"\",\n                //         email: \"\",\n                //         staffid: \"\",\n                //         post: \"\",\n                //         dept: \"\"\n                //     }\n\n                // });\n            }else{\n                alert(\"發生錯誤，請稍後再嘗試\");\n            }\n        }).catch(err => {\n            console.log(\"waitinglist: \" + err);\n        });\n    }\n\n\n    function checkQuota(){\n\n        const courseInfo = newValue.course.split(' ');\n\n        const courseName = newValue.course.split(' ')[0];\n        const courseDate = newValue.course.split(' ')[1];\n\n        console.log(\"Rendering Check quota\");\n\n        const url = \"/checkQuota\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseName\": courseName,\n                \"courseDate\": courseDate\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                return res.json()\n            }else{\n                alert(\"發生錯誤，請稍後再嘗試\");\n                return \"error\";\n            }\n        })\n        .then(res => {\n            console.log(res);\n            if(res.quota === 0){\n                waitinglist(courseName, courseDate);\n            }else if(res !== \"error\"){\n                enroll(res);\n            }\n        }).catch(err => {\n            console.log(\"Login: \" + err);\n        });\n    }\n\n\n    function handleSubmit(event){\n\n        event.preventDefault();\n        checkQuota();\n        //enroll();\n    }\n\n    function clearInput(){\n\n        setNewValue(prevValue => {\n                    \n            return {\n                ...prevValue,\n                username: \"\",\n                email: \"\",\n                staffid: \"\",\n                post: \"\",\n                dept: \"\",\n                course: \"\"\n            }\n\n        });\n\n    }\n\n\n    function handleChange(event){\n\n        const {name, value} = event.target;\n\n        setNewValue(prevValue => {\n            return{\n                ...prevValue,\n                [name]: value\n            }; \n        });\n\n        console.log(newValue);\n    }\n\n    return (\n        <div>\n    <Header />\n    <img src=\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\" className=\"formIcon\"/>\n\n    \n    <Form className=\"inputForm\" onSubmit={handleSubmit}>\n    \n        <div className=\"inputRow\">\n            <div className=\"inputItem\">\n                <FormGroup>\n                    {console.log(\"Rendering name input\")}\n                    <Form.Label className=\"inputLabel\">名稱:</Form.Label>\n                    <Form.Control placeholder={fields[0]} size=\"lg\" onChange={handleChange} value={newValue.username} name=\"username\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup className=\"inputItem\">\n                    {console.log(\"Rendering email input\")}\n                    <Form.Label className=\"inputLabel\">電郵:</Form.Label>\n                    <InputGroup>\n                        <Form.Control placeholder={fields[1]} size=\"lg\" name=\"email\" type=\"text\" onChange={handleChange} value={newValue.email} className=\"input\"></Form.Control>\n                        <InputGroup.Append>\n                            <InputGroup.Text>@hohsc.org.hk</InputGroup.Text>\n                        </InputGroup.Append>\n                    </InputGroup> \n                </FormGroup>\n            </div>\n        </div>\n            \n        <div className=\"inputRow\">\n\n            <div className=\"inputItem\">\n\n                <FormGroup>\n                    {console.log(\"Rendering staffid input\")}\n                    <Form.Label className=\"inputLabel\">職員編號:</Form.Label>\n                    <Form.Control placeholder={fields[2]} size=\"lg\" onChange={handleChange} value={newValue.staffid} name=\"staffid\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    {console.log(\"Rendering post input\")}\n                    <Form.Label className=\"inputLabel\">職位:</Form.Label>\n                    <Form.Control placeholder={fields[3]} size=\"lg\" onChange={handleChange} value={newValue.post} name=\"post\"></Form.Control>\n                </FormGroup>\n            </div>\n\n        </div>\n            \n\n        <div className=\"inputRow\">\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    {console.log(\"Rendering dept input\")}\n                    <Form.Label className=\"inputLabel\">單位:</Form.Label>\n                    <Form.Control placeholder={fields[4]} size=\"lg\" onChange={handleChange} value={newValue.dept} name=\"dept\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    {console.log(\"Rendering course input\")}\n                    <Form.Label className=\"inputLabel\">報讀課程:</Form.Label>\n                    <Form.Control size=\"lg\" onChange={handleChange} value={newValue.course} name=\"course\" as=\"select\">\n                        <option>請選擇課程</option>\n                        {courseList.length > 0 && courseList.map(course => {\n                            var date = new Date(course.date);\n                            return <option>{course.courseName} {date.toLocaleDateString()}</option>\n                        })}\n                    </Form.Control>\n                </FormGroup>\n            </div>\n\n        </div>\n\n        <div className=\"btnWrapper\">\n            <Button variant=\"primary\" size=\"lg\" type=\"submit\" className=\"submitBtn\">提交{console.log(\"Rendering submitbtn\")}</Button>\n\n            <Button variant=\"danger\" size=\"lg\" onClick={clearInput} className=\"clearBtn\">清除所有資料{console.log(\"Rendering clearbtn\")}</Button>\n        </div>\n\n    </Form>\n    <Footer role={role}/>\n    </div>\n    );\n}\n\nexport default ApplicationForm;"]},"metadata":{},"sourceType":"module"}
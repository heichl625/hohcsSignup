{"ast":null,"code":"import _defineProperty from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import auth from\"./Auth\";import Form from'react-bootstrap/Form';import InputGroup from'react-bootstrap/InputGroup';import Button from'react-bootstrap/Button';import{Link,Redirect}from'react-router-dom';import qs from'qs';function Login(){console.log(\"Login IN page, IS authenticated? \"+auth.isAuthenticated());var _useState=useState({username:\"\",password:\"\"}),_useState2=_slicedToArray(_useState,2),userData=_useState2[0],setUserData=_useState2[1];var _useState3=useState({to:\"\",isDirected:null}),_useState4=_slicedToArray(_useState3,2),redirect=_useState4[0],setRedirect=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),reLogin=_useState6[0],setRelogin=_useState6[1];if(localStorage.getItem('isAuthorized')){return/*#__PURE__*/React.createElement(Redirect,{to:\"/\"});}function handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;setUserData(function(prevValue){return _objectSpread(_objectSpread({},prevValue),{},_defineProperty({},name,value));});console.log(userData);}function handleSubmit(event){var user={username:userData.username,password:userData.password};event.preventDefault();var url='/login';var options={method:'POST',headers:{'Accept':'application/json','Content-Type':'application/x-www-form-urlencoded'},body:qs.stringify(user)};fetch(url,options).then(function(res){if(res.status!==401){return res.json();}else{return\"error\";}}).then(function(res){if(res!==\"error\"){console.log(res);localStorage.setItem('userToken',res.token);localStorage.setItem('isAuthorized',true);localStorage.setItem('username',res.user.username);console.log(\"Ready to redirect\");setRedirect({to:\"/\",isDirected:true});}else{setRelogin(true);setUserData({username:\"\",password:\"\"});}});}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"img\",{src:\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\",className:\"icon\"}),reLogin&&/*#__PURE__*/React.createElement(\"p\",{className:\"loginError\"},\"\\u767B\\u5165\\u96FB\\u90F5\\u6216\\u5BC6\\u78BC\\u932F\\u8AA4\\uFF0C\\u8ACB\\u91CD\\u65B0\\u8F38\\u5165\"),/*#__PURE__*/React.createElement(Form,{action:\"/login\",method:\"post\",onSubmit:handleSubmit,className:\"formInput\"},/*#__PURE__*/React.createElement(InputGroup,{className:\"loginInput\"},/*#__PURE__*/React.createElement(Form.Control,{placeholder:\"\\u96FB\\u90F5\",className:\"input\",name:\"username\",onChange:handleChange,value:userData.username}),/*#__PURE__*/React.createElement(InputGroup.Append,null,/*#__PURE__*/React.createElement(InputGroup.Text,{className:\"emailText\"},\"@hohsc.org.hk\"))),/*#__PURE__*/React.createElement(Form.Group,{className:\"loginInput\"},/*#__PURE__*/React.createElement(Form.Control,{placeholder:\"\\u5BC6\\u78BC\",onChange:handleChange,name:\"password\",value:userData.password,type:\"password\"})),/*#__PURE__*/React.createElement(Button,{variant:\"primary\",size:\"lg\",className:\"loginBtn\",type:\"submit\"},\"\\u767B\\u5165\"),/*#__PURE__*/React.createElement(\"p\",{className:\"remindText\"},\"\\u5982\\u672A\\u66FE\\u8A3B\\u518A\\uFF0C\\u8ACB\\u5148\\u8A3B\\u518A\\u3002\"),/*#__PURE__*/React.createElement(Link,{to:\"/register\"},/*#__PURE__*/React.createElement(Button,{variant:\"secondary\",size:\"lg\",className:\"registerBtn\"},\"\\u8A3B\\u518A\"))),redirect.isDirected&&/*#__PURE__*/React.createElement(Redirect,{to:redirect.to}));}export default Login;","map":{"version":3,"sources":["/Users/cheukheilo/Desktop/hohcsSignup/client/src/components/Login.jsx"],"names":["React","useState","auth","Form","InputGroup","Button","Link","Redirect","qs","Login","console","log","isAuthenticated","username","password","userData","setUserData","to","isDirected","redirect","setRedirect","reLogin","setRelogin","localStorage","getItem","handleChange","event","target","name","value","prevValue","handleSubmit","user","preventDefault","url","options","method","headers","body","stringify","fetch","then","res","status","json","setItem","token"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport auth from \"./Auth\";\nimport Form from 'react-bootstrap/Form';\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport Button from 'react-bootstrap/Button';\nimport { Link, Redirect } from 'react-router-dom';\nimport qs from 'qs';\n\nfunction Login() {\n\n    console.log(\"Login IN page, IS authenticated? \" + auth.isAuthenticated())\n\n    const [userData, setUserData] = useState({\n\n        username: \"\",\n        password: \"\"\n\n    });\n\n    const [redirect, setRedirect] = useState({\n        to: \"\",\n        isDirected: null\n    });\n\n    const [reLogin, setRelogin] = useState(false);\n\n    if(localStorage.getItem('isAuthorized')){\n        return <Redirect to=\"/\" />;\n    }\n\n\n    function handleChange(event){\n\n        const {name, value} = event.target;\n\n        setUserData(prevValue => {\n            return {\n                ...prevValue,\n                [name]: value\n            };\n        });\n\n        console.log(userData);\n    }\n\n    function handleSubmit(event){\n\n        const user = {\n            username: userData.username,\n            password: userData.password\n        }\n\n        event.preventDefault();\n\n        const url = '/login';\n        const options = {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/x-www-form-urlencoded'\n            },\n            body: qs.stringify(user)\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status !== 401){\n                return res.json();\n            }else{\n                return \"error\";\n            }\n            \n        })\n        .then(res => {\n\n            if(res !== \"error\"){\n                console.log(res)\n                localStorage.setItem('userToken', res.token);\n                localStorage.setItem('isAuthorized', true);\n                localStorage.setItem('username', res.user.username);\n                console.log(\"Ready to redirect\");\n                setRedirect({\n                    to: \"/\",\n                    isDirected: true\n                });\n            }else{\n                setRelogin(true);\n                setUserData({\n                    username: \"\",\n                    password: \"\"\n                })\n            }\n            \n        })\n    }\n\n    return(\n        <React.Fragment>\n        <img src=\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\" className=\"icon\"/>\n\n    { reLogin && <p className=\"loginError\">登入電郵或密碼錯誤，請重新輸入</p> }\n    \n    {/* onSubmit={handleSubmit} */}\n        <Form action=\"/login\" method=\"post\" onSubmit={handleSubmit} className=\"formInput\">\n            \n                    <InputGroup className=\"loginInput\">\n                        <Form.Control placeholder=\"電郵\" className=\"input\" name=\"username\" onChange={handleChange} value={userData.username}></Form.Control>\n                        <InputGroup.Append>\n                            <InputGroup.Text className=\"emailText\">@hohsc.org.hk</InputGroup.Text>\n                        </InputGroup.Append>\n                    </InputGroup> \n       \n         \n                    <Form.Group className=\"loginInput\">\n                        <Form.Control placeholder=\"密碼\" onChange={handleChange} name=\"password\" value={userData.password} type=\"password\"></Form.Control>\n                    </Form.Group>\n            \n            {/* onClick={handleLogin} */}\n                <Button variant=\"primary\" size=\"lg\" className=\"loginBtn\" type=\"submit\">登入</Button>\n                <p className=\"remindText\">如未曾註冊，請先註冊。</p>\n\n                \n                <Link to=\"/register\">\n                    <Button variant=\"secondary\" size=\"lg\" className=\"registerBtn\">註冊</Button>\n                </Link>\n                \n                \n                \n        </Form>\n        {redirect.isDirected && <Redirect to={redirect.to} /> }\n\n        </React.Fragment>\n    );\n\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}
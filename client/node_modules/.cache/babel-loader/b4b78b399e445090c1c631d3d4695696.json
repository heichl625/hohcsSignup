{"ast":null,"code":"import _defineProperty from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cheukheilo/Desktop/hohcsSignup/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Header from\"./Header\";import Footer from\"./Footer\";import Button from'react-bootstrap/Button';import Form from'react-bootstrap/Form';import FormGroup from'react-bootstrap/FormGroup';import InputGroup from'react-bootstrap/InputGroup';import qs from'qs';function ApplicationForm(){var _useState=useState([{}]),_useState2=_slicedToArray(_useState,2),courseList=_useState2[0],setCourseList=_useState2[1];var _useState3=useState({username:\"\",email:\"\",staffid:\"\",post:\"\",dept:\"\",course:\"\"}),_useState4=_slicedToArray(_useState3,2),newValue=_useState4[0],setNewValue=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isDataObtained=_useState6[0],setIsDataObtained=_useState6[1];var fields=[\"姓名\",\"電郵\",\"職員編號\",\"職位\",\"單位\",\"報讀課程\"];var role=\"\";function getFutureCourses(){var futureCourseURL=\"/futureCourse\";var futureCourseOptions={method:\"GET\",headers:{\"Accept\":\"application/json; odata: verbose\",\"Content-Type\":\"application/json\"}};fetch(futureCourseURL,futureCourseOptions).then(function(res){return res.text();}).then(function(res){console.log(res);var resJson=JSON.parse(res.text);if(resJson.length>0){console.log(\"CourseList[0]: \"+resJson[0].courseName);setCourseList(resJson);setNewValue(function(prevValue){var date=new Date(resJson[0].date);var dateStr=date.toLocaleDateString();return _objectSpread(_objectSpread({},prevValue),{},{course:res[0].courseName+\" \"+dateStr});});console.log(\"DataObtained: \"+isDataObtained);console.log(courseList);}setIsDataObtained(true);}).catch(function(err){console.log(\"futureCourse: \"+err);});}useEffect(function(){console.log(\"render\");if(!isDataObtained){var url=\"/user\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/json\"},body:qs.stringify({\"username\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){return res.json();}).then(function(res){role=res.role;if(role===\"admin\"){localStorage.setItem(\"isAdmin\",true);}setNewValue({username:res.name,email:res.username,staffid:res.staffid,post:res.post,dept:res.dept,course:\"\"});}).catch(function(err){console.log(\"user: \"+err);});}getFutureCourses();});function enroll(course){console.log(course);var url=\"/enroll\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseID\":course._id,\"enrollment\":newValue,\"registeredBy\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){if(res.status===200){alert(\"成功報讀課程\");clearInput();// setNewValue(prevValue => {\n//     return {\n//         ...prevValue,\n//         username: \"\",\n//         email: \"\",\n//         staffid: \"\",\n//         post: \"\",\n//         dept: \"\"\n//     }\n// });\n}else{alert(\"未能成功報讀課程, 請稍後再嘗試\");}}).catch(function(err){console.log(\"enroll: \"+err);});}function waitinglist(courseName,courseDate){var url=\"/waitinglist\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseName\":courseName,\"courseDate\":courseDate,\"enrollment\":newValue,\"registeredBy\":localStorage.getItem(\"username\")})};fetch(url,options).then(function(res){if(res.status===200){alert(\"課程名額暫滿，你將會加進後備名單。如最後能夠成功報讀，屆時將會以公司電郵通知\");clearInput();// setNewValue(prevValue => {\n//     return {\n//         ...prevValue,\n//         username: \"\",\n//         email: \"\",\n//         staffid: \"\",\n//         post: \"\",\n//         dept: \"\"\n//     }\n// });\n}else{alert(\"發生錯誤，請稍後再嘗試\");}}).catch(function(err){console.log(\"waitinglist: \"+err);});}function checkQuota(){var courseInfo=newValue.course.split(' ');console.log(\"date: \"+courseInfo[1]);var courseName=newValue.course.split(' ')[0];var courseDate=newValue.course.split(' ')[1];var url=\"/checkQuota\";var options={method:\"POST\",headers:{\"Accept\":\"application/json\",\"Content-Type\":\"application/x-www-form-urlencoded\"},body:qs.stringify({\"courseName\":courseName,\"courseDate\":courseDate})};fetch(url,options).then(function(res){if(res.status===200){return res.json();}else{alert(\"發生錯誤，請稍後再嘗試\");return\"error\";}}).then(function(res){console.log(res);if(res.quota===0){waitinglist(courseName,courseDate);}else if(res!==\"error\"){console.log(\"Enrolled\");enroll(res);}}).catch(function(err){console.log(\"Login: \"+err);});}function handleSubmit(event){event.preventDefault();checkQuota();//enroll();\n}function clearInput(){setNewValue(function(prevValue){return _objectSpread(_objectSpread({},prevValue),{},{username:\"\",email:\"\",staffid:\"\",post:\"\",dept:\"\",course:\"\"});});}function handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;setNewValue(function(prevValue){return _objectSpread(_objectSpread({},prevValue),{},_defineProperty({},name,value));});console.log(newValue);}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(\"img\",{src:\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\",className:\"formIcon\"}),/*#__PURE__*/React.createElement(Form,{className:\"inputForm\",onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u540D\\u7A31:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[0],size:\"lg\",onChange:handleChange,value:newValue.username,name:\"username\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,{className:\"inputItem\"},/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u96FB\\u90F5:\"),/*#__PURE__*/React.createElement(InputGroup,null,/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[1],size:\"lg\",name:\"email\",type:\"text\",onChange:handleChange,value:newValue.email,className:\"input\"}),/*#__PURE__*/React.createElement(InputGroup.Append,null,/*#__PURE__*/React.createElement(InputGroup.Text,null,\"@hohsc.org.hk\")))))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u8077\\u54E1\\u7DE8\\u865F:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[2],size:\"lg\",onChange:handleChange,value:newValue.staffid,name:\"staffid\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u8077\\u4F4D:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[3],size:\"lg\",onChange:handleChange,value:newValue.post,name:\"post\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputRow\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u55AE\\u4F4D:\"),/*#__PURE__*/React.createElement(Form.Control,{placeholder:fields[4],size:\"lg\",onChange:handleChange,value:newValue.dept,name:\"dept\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"inputItem\"},/*#__PURE__*/React.createElement(FormGroup,null,/*#__PURE__*/React.createElement(Form.Label,{className:\"inputLabel\"},\"\\u5831\\u8B80\\u8AB2\\u7A0B:\"),/*#__PURE__*/React.createElement(Form.Control,{size:\"lg\",onChange:handleChange,value:newValue.course,name:\"course\",as:\"select\"},/*#__PURE__*/React.createElement(\"option\",null,\"\\u8ACB\\u9078\\u64C7\\u8AB2\\u7A0B\"),courseList.length>0&&courseList.map(function(course){var date=new Date(course.date);return/*#__PURE__*/React.createElement(\"option\",null,course.courseName,\" \",date.toLocaleDateString());}))))),/*#__PURE__*/React.createElement(\"div\",{className:\"btnWrapper\"},/*#__PURE__*/React.createElement(Button,{variant:\"primary\",size:\"lg\",type:\"submit\",className:\"submitBtn\"},\"\\u63D0\\u4EA4\"),/*#__PURE__*/React.createElement(Button,{variant:\"danger\",size:\"lg\",onClick:clearInput,className:\"clearBtn\"},\"\\u6E05\\u9664\\u6240\\u6709\\u8CC7\\u6599\"))),/*#__PURE__*/React.createElement(Footer,{role:role}));}export default ApplicationForm;","map":{"version":3,"sources":["/Users/cheukheilo/Desktop/hohcsSignup/client/src/components/ApplicationForm.jsx"],"names":["React","useState","useEffect","Header","Footer","Button","Form","FormGroup","InputGroup","qs","ApplicationForm","courseList","setCourseList","username","email","staffid","post","dept","course","newValue","setNewValue","isDataObtained","setIsDataObtained","fields","role","getFutureCourses","futureCourseURL","futureCourseOptions","method","headers","fetch","then","res","text","console","log","resJson","JSON","parse","length","courseName","prevValue","date","Date","dateStr","toLocaleDateString","catch","err","url","options","body","stringify","localStorage","getItem","json","setItem","name","enroll","_id","status","alert","clearInput","waitinglist","courseDate","checkQuota","courseInfo","split","quota","handleSubmit","event","preventDefault","handleChange","target","value","map"],"mappings":"0eAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,KAAyC,OAAzC,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,wBAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,MAAOC,CAAAA,SAAP,KAAsB,2BAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,4BAAvB,CACA,MAAOC,CAAAA,EAAP,KAAe,IAAf,CAEA,QAASC,CAAAA,eAAT,EAA0B,eAGcT,QAAQ,CAAC,CAAC,EAAD,CAAD,CAHtB,wCAGfU,UAHe,eAGHC,aAHG,8BAKUX,QAAQ,CAAC,CACrCY,QAAQ,CAAE,EAD2B,CAErCC,KAAK,CAAE,EAF8B,CAGrCC,OAAO,CAAE,EAH4B,CAIrCC,IAAI,CAAE,EAJ+B,CAKrCC,IAAI,CAAE,EAL+B,CAMrCC,MAAM,CAAE,EAN6B,CAAD,CALlB,yCAKfC,QALe,eAKLC,WALK,8BAcsBnB,QAAQ,CAAC,KAAD,CAd9B,yCAcfoB,cAde,eAcCC,iBAdD,eAiBtB,GAAMC,CAAAA,MAAM,CAAG,CAAC,IAAD,CAAO,IAAP,CAAa,MAAb,CAAqB,IAArB,CAA2B,IAA3B,CAAiC,MAAjC,CAAf,CACA,GAAIC,CAAAA,IAAI,CAAG,EAAX,CAEA,QAASC,CAAAA,gBAAT,EAA2B,CAEvB,GAAMC,CAAAA,eAAe,CAAG,eAAxB,CACA,GAAMC,CAAAA,mBAAmB,CAAG,CACxBC,MAAM,CAAE,KADgB,CAExBC,OAAO,CAAE,CACP,SAAU,kCADH,CAEP,eAAgB,kBAFT,CAFe,CAA5B,CAQAC,KAAK,CAACJ,eAAD,CAAkBC,mBAAlB,CAAL,CACCI,IADD,CACM,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,IAAJ,EAAJ,EADT,EAECF,IAFD,CAEM,SAAAC,GAAG,CAAI,CACTE,OAAO,CAACC,GAAR,CAAYH,GAAZ,EACA,GAAMI,CAAAA,OAAO,CAAGC,IAAI,CAACC,KAAL,CAAWN,GAAG,CAACC,IAAf,CAAhB,CACA,GAAGG,OAAO,CAACG,MAAR,CAAiB,CAApB,CAAsB,CACdL,OAAO,CAACC,GAAR,CAAY,kBAAoBC,OAAO,CAAC,CAAD,CAAP,CAAWI,UAA3C,EACA5B,aAAa,CAACwB,OAAD,CAAb,CACAhB,WAAW,CAAC,SAAAqB,SAAS,CAAI,CAErB,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAASP,OAAO,CAAC,CAAD,CAAP,CAAWM,IAApB,CAAb,CACA,GAAME,CAAAA,OAAO,CAAGF,IAAI,CAACG,kBAAL,EAAhB,CAEA,sCACOJ,SADP,MAEIvB,MAAM,CAAEc,GAAG,CAAC,CAAD,CAAH,CAAOQ,UAAP,CAAoB,GAApB,CAA0BI,OAFtC,GAIH,CATU,CAAX,CAUAV,OAAO,CAACC,GAAR,CAAY,iBAAmBd,cAA/B,EACAa,OAAO,CAACC,GAAR,CAAYxB,UAAZ,EACH,CACLW,iBAAiB,CAAC,IAAD,CAAjB,CACH,CAtBD,EAsBGwB,KAtBH,CAsBS,SAAAC,GAAG,CAAI,CACZb,OAAO,CAACC,GAAR,CAAY,iBAAmBY,GAA/B,EACH,CAxBD,EAyBH,CAED7C,SAAS,CAAE,UAAM,CAEbgC,OAAO,CAACC,GAAR,CAAY,QAAZ,EAEA,GAAG,CAACd,cAAJ,CAAmB,CACf,GAAM2B,CAAAA,GAAG,CAAG,OAAZ,CACA,GAAMC,CAAAA,OAAO,CAAG,CACZrB,MAAM,CAAE,MADI,CAEZC,OAAO,CAAE,CACP,SAAU,kBADH,CAEP,eAAgB,kBAFT,CAFG,CAMZqB,IAAI,CAAEzC,EAAE,CAAC0C,SAAH,CAAa,CAAC,WAAYC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAb,CAAb,CANM,CAAhB,CASAvB,KAAK,CAACkB,GAAD,CAAMC,OAAN,CAAL,CACClB,IADD,CACM,SAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACsB,IAAJ,EAAJ,EADT,EAECvB,IAFD,CAEM,SAAAC,GAAG,CAAI,CAETR,IAAI,CAAGQ,GAAG,CAACR,IAAX,CAEA,GAAGA,IAAI,GAAK,OAAZ,CAAoB,CAChB4B,YAAY,CAACG,OAAb,CAAqB,SAArB,CAAgC,IAAhC,EACH,CAEDnC,WAAW,CAAC,CACRP,QAAQ,CAAEmB,GAAG,CAACwB,IADN,CAER1C,KAAK,CAAEkB,GAAG,CAACnB,QAFH,CAGRE,OAAO,CAAEiB,GAAG,CAACjB,OAHL,CAIRC,IAAI,CAAEgB,GAAG,CAAChB,IAJF,CAKRC,IAAI,CAAEe,GAAG,CAACf,IALF,CAMRC,MAAM,CAAE,EANA,CAAD,CAAX,CAQH,CAlBD,EAkBG4B,KAlBH,CAkBS,SAAAC,GAAG,CAAI,CACZb,OAAO,CAACC,GAAR,CAAY,SAAWY,GAAvB,EACH,CApBD,EAqBH,CACGtB,gBAAgB,GAEvB,CAvCQ,CAAT,CAyCA,QAASgC,CAAAA,MAAT,CAAgBvC,MAAhB,CAAuB,CAEnBgB,OAAO,CAACC,GAAR,CAAYjB,MAAZ,EAEA,GAAM8B,CAAAA,GAAG,CAAG,SAAZ,CACA,GAAMC,CAAAA,OAAO,CAAG,CACZrB,MAAM,CAAE,MADI,CAEZC,OAAO,CAAE,CACP,SAAU,kBADH,CAEP,eAAgB,mCAFT,CAFG,CAMZqB,IAAI,CAAEzC,EAAE,CAAC0C,SAAH,CAAa,CACf,WAAYjC,MAAM,CAACwC,GADJ,CAEf,aAAcvC,QAFC,CAGf,eAAgBiC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAHD,CAAb,CANM,CAAhB,CAaAvB,KAAK,CAACkB,GAAD,CAAMC,OAAN,CAAL,CACClB,IADD,CACM,SAAAC,GAAG,CAAI,CACT,GAAGA,GAAG,CAAC2B,MAAJ,GAAe,GAAlB,CAAsB,CAClBC,KAAK,CAAC,QAAD,CAAL,CACAC,UAAU,GACV;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACH,CAfD,IAeK,CACDD,KAAK,CAAC,kBAAD,CAAL,CACH,CACJ,CApBD,EAoBGd,KApBH,CAoBS,SAAAC,GAAG,CAAI,CACZb,OAAO,CAACC,GAAR,CAAY,WAAaY,GAAzB,EACH,CAtBD,EAuBH,CAID,QAASe,CAAAA,WAAT,CAAqBtB,UAArB,CAAiCuB,UAAjC,CAA4C,CAExC,GAAMf,CAAAA,GAAG,CAAG,cAAZ,CACA,GAAMC,CAAAA,OAAO,CAAG,CACZrB,MAAM,CAAE,MADI,CAEZC,OAAO,CAAE,CACP,SAAU,kBADH,CAEP,eAAgB,mCAFT,CAFG,CAMZqB,IAAI,CAAEzC,EAAE,CAAC0C,SAAH,CAAa,CACf,aAAcX,UADC,CAEf,aAAcuB,UAFC,CAGf,aAAc5C,QAHC,CAIf,eAAgBiC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAJD,CAAb,CANM,CAAhB,CAcAvB,KAAK,CAACkB,GAAD,CAAMC,OAAN,CAAL,CACClB,IADD,CACM,SAAAC,GAAG,CAAI,CACT,GAAGA,GAAG,CAAC2B,MAAJ,GAAe,GAAlB,CAAsB,CAClBC,KAAK,CAAC,wCAAD,CAAL,CACAC,UAAU,GACV;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACH,CAfD,IAeK,CACDD,KAAK,CAAC,aAAD,CAAL,CACH,CACJ,CApBD,EAoBGd,KApBH,CAoBS,SAAAC,GAAG,CAAI,CACZb,OAAO,CAACC,GAAR,CAAY,gBAAkBY,GAA9B,EACH,CAtBD,EAuBH,CAGD,QAASiB,CAAAA,UAAT,EAAqB,CAEjB,GAAMC,CAAAA,UAAU,CAAG9C,QAAQ,CAACD,MAAT,CAAgBgD,KAAhB,CAAsB,GAAtB,CAAnB,CAEAhC,OAAO,CAACC,GAAR,CAAY,SAAY8B,UAAU,CAAC,CAAD,CAAlC,EAEA,GAAMzB,CAAAA,UAAU,CAAGrB,QAAQ,CAACD,MAAT,CAAgBgD,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAnB,CACA,GAAMH,CAAAA,UAAU,CAAG5C,QAAQ,CAACD,MAAT,CAAgBgD,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAnB,CAEA,GAAMlB,CAAAA,GAAG,CAAG,aAAZ,CACA,GAAMC,CAAAA,OAAO,CAAG,CACZrB,MAAM,CAAE,MADI,CAEZC,OAAO,CAAE,CACP,SAAU,kBADH,CAEP,eAAgB,mCAFT,CAFG,CAMZqB,IAAI,CAAEzC,EAAE,CAAC0C,SAAH,CAAa,CACf,aAAcX,UADC,CAEf,aAAcuB,UAFC,CAAb,CANM,CAAhB,CAYAjC,KAAK,CAACkB,GAAD,CAAMC,OAAN,CAAL,CACClB,IADD,CACM,SAAAC,GAAG,CAAI,CACT,GAAGA,GAAG,CAAC2B,MAAJ,GAAe,GAAlB,CAAsB,CAClB,MAAO3B,CAAAA,GAAG,CAACsB,IAAJ,EAAP,CACH,CAFD,IAEK,CACDM,KAAK,CAAC,aAAD,CAAL,CACA,MAAO,OAAP,CACH,CACJ,CARD,EASC7B,IATD,CASM,SAAAC,GAAG,CAAI,CACTE,OAAO,CAACC,GAAR,CAAYH,GAAZ,EACA,GAAGA,GAAG,CAACmC,KAAJ,GAAc,CAAjB,CAAmB,CACfL,WAAW,CAACtB,UAAD,CAAauB,UAAb,CAAX,CACH,CAFD,IAEM,IAAG/B,GAAG,GAAK,OAAX,CAAmB,CACrBE,OAAO,CAACC,GAAR,CAAY,UAAZ,EACAsB,MAAM,CAACzB,GAAD,CAAN,CACH,CACJ,CAjBD,EAiBGc,KAjBH,CAiBS,SAAAC,GAAG,CAAI,CACZb,OAAO,CAACC,GAAR,CAAY,UAAYY,GAAxB,EACH,CAnBD,EAoBH,CAGD,QAASqB,CAAAA,YAAT,CAAsBC,KAAtB,CAA4B,CAExBA,KAAK,CAACC,cAAN,GACAN,UAAU,GACV;AACH,CAED,QAASH,CAAAA,UAAT,EAAqB,CAEjBzC,WAAW,CAAC,SAAAqB,SAAS,CAAI,CAErB,sCACOA,SADP,MAEI5B,QAAQ,CAAE,EAFd,CAGIC,KAAK,CAAE,EAHX,CAIIC,OAAO,CAAE,EAJb,CAKIC,IAAI,CAAE,EALV,CAMIC,IAAI,CAAE,EANV,CAOIC,MAAM,CAAE,EAPZ,GAUH,CAZU,CAAX,CAcH,CAGD,QAASqD,CAAAA,YAAT,CAAsBF,KAAtB,CAA4B,mBAEFA,KAAK,CAACG,MAFJ,CAEjBhB,IAFiB,eAEjBA,IAFiB,CAEXiB,KAFW,eAEXA,KAFW,CAIxBrD,WAAW,CAAC,SAAAqB,SAAS,CAAI,CACrB,sCACOA,SADP,wBAEKe,IAFL,CAEYiB,KAFZ,GAIH,CALU,CAAX,CAOAvC,OAAO,CAACC,GAAR,CAAYhB,QAAZ,EACH,CAED,mBACI,4CACJ,oBAAC,MAAD,MADI,cAEJ,2BAAK,GAAG,CAAC,sGAAT,CAAgH,SAAS,CAAC,UAA1H,EAFI,cAKJ,oBAAC,IAAD,EAAM,SAAS,CAAC,WAAhB,CAA4B,QAAQ,CAAEiD,YAAtC,eAEI,2BAAK,SAAS,CAAC,UAAf,eACI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,mBACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,kBADJ,cAEI,oBAAC,IAAD,CAAM,OAAN,EAAc,WAAW,CAAE7C,MAAM,CAAC,CAAD,CAAjC,CAAsC,IAAI,CAAC,IAA3C,CAAgD,QAAQ,CAAEgD,YAA1D,CAAwE,KAAK,CAAEpD,QAAQ,CAACN,QAAxF,CAAkG,IAAI,CAAC,UAAvG,EAFJ,CADJ,CADJ,cAQI,2BAAK,SAAS,CAAC,WAAf,EARJ,cAUI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,EAAW,SAAS,CAAC,WAArB,eACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,kBADJ,cAEI,oBAAC,UAAD,mBACI,oBAAC,IAAD,CAAM,OAAN,EAAc,WAAW,CAAEU,MAAM,CAAC,CAAD,CAAjC,CAAsC,IAAI,CAAC,IAA3C,CAAgD,IAAI,CAAC,OAArD,CAA6D,IAAI,CAAC,MAAlE,CAAyE,QAAQ,CAAEgD,YAAnF,CAAiG,KAAK,CAAEpD,QAAQ,CAACL,KAAjH,CAAwH,SAAS,CAAC,OAAlI,EADJ,cAEI,oBAAC,UAAD,CAAY,MAAZ,mBACI,oBAAC,UAAD,CAAY,IAAZ,sBADJ,CAFJ,CAFJ,CADJ,CAVJ,CAFJ,cAyBI,2BAAK,SAAS,CAAC,UAAf,eAEI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,mBACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,8BADJ,cAEI,oBAAC,IAAD,CAAM,OAAN,EAAc,WAAW,CAAES,MAAM,CAAC,CAAD,CAAjC,CAAsC,IAAI,CAAC,IAA3C,CAAgD,QAAQ,CAAEgD,YAA1D,CAAwE,KAAK,CAAEpD,QAAQ,CAACJ,OAAxF,CAAiG,IAAI,CAAC,SAAtG,EAFJ,CADJ,CAFJ,cASI,2BAAK,SAAS,CAAC,WAAf,EATJ,cAWI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,mBACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,kBADJ,cAEI,oBAAC,IAAD,CAAM,OAAN,EAAc,WAAW,CAAEQ,MAAM,CAAC,CAAD,CAAjC,CAAsC,IAAI,CAAC,IAA3C,CAAgD,QAAQ,CAAEgD,YAA1D,CAAwE,KAAK,CAAEpD,QAAQ,CAACH,IAAxF,CAA8F,IAAI,CAAC,MAAnG,EAFJ,CADJ,CAXJ,CAzBJ,cA8CI,2BAAK,SAAS,CAAC,UAAf,eAEI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,mBACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,kBADJ,cAEI,oBAAC,IAAD,CAAM,OAAN,EAAc,WAAW,CAAEO,MAAM,CAAC,CAAD,CAAjC,CAAsC,IAAI,CAAC,IAA3C,CAAgD,QAAQ,CAAEgD,YAA1D,CAAwE,KAAK,CAAEpD,QAAQ,CAACF,IAAxF,CAA8F,IAAI,CAAC,MAAnG,EAFJ,CADJ,CAFJ,cASI,2BAAK,SAAS,CAAC,WAAf,EATJ,cAWI,2BAAK,SAAS,CAAC,WAAf,eACI,oBAAC,SAAD,mBACI,oBAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,8BADJ,cAEI,oBAAC,IAAD,CAAM,OAAN,EAAc,IAAI,CAAC,IAAnB,CAAwB,QAAQ,CAAEsD,YAAlC,CAAgD,KAAK,CAAEpD,QAAQ,CAACD,MAAhE,CAAwE,IAAI,CAAC,QAA7E,CAAsF,EAAE,CAAC,QAAzF,eACI,mEADJ,CAEKP,UAAU,CAAC4B,MAAX,CAAoB,CAApB,EAAyB5B,UAAU,CAAC+D,GAAX,CAAe,SAAAxD,MAAM,CAAI,CAC/C,GAAIwB,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAASzB,MAAM,CAACwB,IAAhB,CAAX,CACA,mBAAO,kCAASxB,MAAM,CAACsB,UAAhB,KAA6BE,IAAI,CAACG,kBAAL,EAA7B,CAAP,CACH,CAHyB,CAF9B,CAFJ,CADJ,CAXJ,CA9CJ,cAwEI,2BAAK,SAAS,CAAC,YAAf,eACI,oBAAC,MAAD,EAAQ,OAAO,CAAC,SAAhB,CAA0B,IAAI,CAAC,IAA/B,CAAoC,IAAI,CAAC,QAAzC,CAAkD,SAAS,CAAC,WAA5D,iBADJ,cAGI,oBAAC,MAAD,EAAQ,OAAO,CAAC,QAAhB,CAAyB,IAAI,CAAC,IAA9B,CAAmC,OAAO,CAAEgB,UAA5C,CAAwD,SAAS,CAAC,UAAlE,yCAHJ,CAxEJ,CALI,cAoFJ,oBAAC,MAAD,EAAQ,IAAI,CAAErC,IAAd,EApFI,CADJ,CAwFH,CAED,cAAed,CAAAA,eAAf","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport FormGroup from 'react-bootstrap/FormGroup';\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport qs from 'qs';\n\nfunction ApplicationForm(){\n\n\n    const [courseList, setCourseList] = useState([{}]);\n\n    const [newValue, setNewValue] = useState({\n        username: \"\",\n        email: \"\",\n        staffid: \"\",\n        post: \"\",\n        dept: \"\",\n        course: \"\",\n    });\n    \n    const [isDataObtained, setIsDataObtained] = useState(false);\n   \n\n    const fields = [\"姓名\", \"電郵\", \"職員編號\", \"職位\", \"單位\", \"報讀課程\"];\n    var role = \"\";\n\n    function getFutureCourses(){\n\n        const futureCourseURL = \"/futureCourse\";\n        const futureCourseOptions = {\n            method: \"GET\",\n            headers: {\n              \"Accept\": \"application/json; odata: verbose\",\n              \"Content-Type\": \"application/json\"\n            }\n        };\n\n        fetch(futureCourseURL, futureCourseOptions)\n        .then(res => res.text())\n        .then(res => {\n            console.log(res);\n            const resJson = JSON.parse(res.text);\n            if(resJson.length > 0){\n                    console.log(\"CourseList[0]: \" + resJson[0].courseName);\n                    setCourseList(resJson);\n                    setNewValue(prevValue => {\n    \n                        const date = new Date(resJson[0].date);\n                        const dateStr = date.toLocaleDateString();\n    \n                        return{\n                            ...prevValue,\n                            course: res[0].courseName + \" \" + dateStr\n                        }\n                    })\n                    console.log(\"DataObtained: \" + isDataObtained);\n                    console.log(courseList);\n                }\n            setIsDataObtained(true);\n        }).catch(err => {\n            console.log(\"futureCourse: \" + err);\n        });\n    }\n\n    useEffect( () => {\n\n        console.log(\"render\");\n\n        if(!isDataObtained){\n            const url = \"/user\";\n            const options = {\n                method: \"POST\",\n                headers: {\n                  \"Accept\": \"application/json\",\n                  \"Content-Type\": \"application/json\"\n                },\n                body: qs.stringify({\"username\": localStorage.getItem(\"username\")})\n            };\n\n            fetch(url, options)\n            .then(res => res.json())\n            .then(res => {\n\n                role = res.role;\n\n                if(role === \"admin\"){\n                    localStorage.setItem(\"isAdmin\", true);\n                }\n\n                setNewValue({\n                    username: res.name,\n                    email: res.username,\n                    staffid: res.staffid,\n                    post: res.post,\n                    dept: res.dept,\n                    course: \"\",\n                })\n            }).catch(err => {\n                console.log(\"user: \" + err);\n            });\n        }\n            getFutureCourses();\n\n    })\n\n    function enroll(course){\n\n        console.log(course);\n\n        const url = \"/enroll\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseID\": course._id, \n                \"enrollment\": newValue,\n                \"registeredBy\": localStorage.getItem(\"username\")\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                alert(\"成功報讀課程\");\n                clearInput();\n                // setNewValue(prevValue => {\n                    \n                //     return {\n                //         ...prevValue,\n                //         username: \"\",\n                //         email: \"\",\n                //         staffid: \"\",\n                //         post: \"\",\n                //         dept: \"\"\n                //     }\n\n                // });\n            }else{\n                alert(\"未能成功報讀課程, 請稍後再嘗試\");\n            }\n        }).catch(err => {\n            console.log(\"enroll: \" + err);\n        });\n    }\n\n\n\n    function waitinglist(courseName, courseDate){\n\n        const url = \"/waitinglist\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseName\": courseName,\n                \"courseDate\": courseDate,\n                \"enrollment\": newValue,\n                \"registeredBy\": localStorage.getItem(\"username\")\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                alert(\"課程名額暫滿，你將會加進後備名單。如最後能夠成功報讀，屆時將會以公司電郵通知\");\n                clearInput();\n                // setNewValue(prevValue => {\n                    \n                //     return {\n                //         ...prevValue,\n                //         username: \"\",\n                //         email: \"\",\n                //         staffid: \"\",\n                //         post: \"\",\n                //         dept: \"\"\n                //     }\n\n                // });\n            }else{\n                alert(\"發生錯誤，請稍後再嘗試\");\n            }\n        }).catch(err => {\n            console.log(\"waitinglist: \" + err);\n        });\n    }\n\n\n    function checkQuota(){\n\n        const courseInfo = newValue.course.split(' ')\n\n        console.log(\"date: \" +  courseInfo[1]);\n\n        const courseName = newValue.course.split(' ')[0];\n        const courseDate = newValue.course.split(' ')[1];\n\n        const url = \"/checkQuota\";\n        const options = {\n            method: \"POST\",\n            headers: {\n              \"Accept\": \"application/json\",\n              \"Content-Type\": \"application/x-www-form-urlencoded\"\n            },\n            body: qs.stringify({\n                \"courseName\": courseName,\n                \"courseDate\": courseDate\n            })\n        };\n\n        fetch(url, options)\n        .then(res => {\n            if(res.status === 200){\n                return res.json()\n            }else{\n                alert(\"發生錯誤，請稍後再嘗試\");\n                return \"error\";\n            }\n        })\n        .then(res => {\n            console.log(res);\n            if(res.quota === 0){\n                waitinglist(courseName, courseDate);\n            }else if(res !== \"error\"){\n                console.log(\"Enrolled\");\n                enroll(res);\n            }\n        }).catch(err => {\n            console.log(\"Login: \" + err);\n        });\n    }\n\n\n    function handleSubmit(event){\n\n        event.preventDefault();\n        checkQuota();\n        //enroll();\n    }\n\n    function clearInput(){\n\n        setNewValue(prevValue => {\n                    \n            return {\n                ...prevValue,\n                username: \"\",\n                email: \"\",\n                staffid: \"\",\n                post: \"\",\n                dept: \"\",\n                course: \"\"\n            }\n\n        });\n\n    }\n\n\n    function handleChange(event){\n\n        const {name, value} = event.target;\n\n        setNewValue(prevValue => {\n            return{\n                ...prevValue,\n                [name]: value\n            }; \n        });\n\n        console.log(newValue);\n    }\n\n    return (\n        <div>\n    <Header />\n    <img src=\"https://www.hohcs.org.hk/App/Modules/Admin/Tpl/Static/upload/image/20170418/20170418125117_21846.png\" className=\"formIcon\"/>\n\n    \n    <Form className=\"inputForm\" onSubmit={handleSubmit}>\n    \n        <div className=\"inputRow\">\n            <div className=\"inputItem\">\n                <FormGroup>\n                    <Form.Label className=\"inputLabel\">名稱:</Form.Label>\n                    <Form.Control placeholder={fields[0]} size=\"lg\" onChange={handleChange} value={newValue.username} name=\"username\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup className=\"inputItem\">\n                    <Form.Label className=\"inputLabel\">電郵:</Form.Label>\n                    <InputGroup>\n                        <Form.Control placeholder={fields[1]} size=\"lg\" name=\"email\" type=\"text\" onChange={handleChange} value={newValue.email} className=\"input\"></Form.Control>\n                        <InputGroup.Append>\n                            <InputGroup.Text>@hohsc.org.hk</InputGroup.Text>\n                        </InputGroup.Append>\n                    </InputGroup> \n                </FormGroup>\n            </div>\n        </div>\n            \n        <div className=\"inputRow\">\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    <Form.Label className=\"inputLabel\">職員編號:</Form.Label>\n                    <Form.Control placeholder={fields[2]} size=\"lg\" onChange={handleChange} value={newValue.staffid} name=\"staffid\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    <Form.Label className=\"inputLabel\">職位:</Form.Label>\n                    <Form.Control placeholder={fields[3]} size=\"lg\" onChange={handleChange} value={newValue.post} name=\"post\"></Form.Control>\n                </FormGroup>\n            </div>\n\n        </div>\n            \n\n        <div className=\"inputRow\">\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    <Form.Label className=\"inputLabel\">單位:</Form.Label>\n                    <Form.Control placeholder={fields[4]} size=\"lg\" onChange={handleChange} value={newValue.dept} name=\"dept\"></Form.Control>\n                </FormGroup>\n            </div>\n\n            <div className=\"inputItem\"></div>\n\n            <div className=\"inputItem\">\n                <FormGroup>\n                    <Form.Label className=\"inputLabel\">報讀課程:</Form.Label>\n                    <Form.Control size=\"lg\" onChange={handleChange} value={newValue.course} name=\"course\" as=\"select\">\n                        <option>請選擇課程</option>\n                        {courseList.length > 0 && courseList.map(course => {\n                            var date = new Date(course.date);\n                            return <option>{course.courseName} {date.toLocaleDateString()}</option>\n                        })}\n                    </Form.Control>\n                </FormGroup>\n            </div>\n\n        </div>\n\n        <div className=\"btnWrapper\">\n            <Button variant=\"primary\" size=\"lg\" type=\"submit\" className=\"submitBtn\">提交</Button>\n\n            <Button variant=\"danger\" size=\"lg\" onClick={clearInput} className=\"clearBtn\">清除所有資料</Button>\n        </div>\n\n    </Form>\n    <Footer role={role}/>\n    </div>\n    );\n}\n\nexport default ApplicationForm;"]},"metadata":{},"sourceType":"module"}